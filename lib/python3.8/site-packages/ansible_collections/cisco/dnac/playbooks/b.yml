---
- hosts: dnac_servers
  vars_files:
    - credentials.yml
  vars:
    dnac_login: &dnac_login
      dnac_host: "{{ dnac_host }}"
      dnac_username: "{{ dnac_username }}"
      dnac_password: "{{ dnac_password }}"
      dnac_verify: "{{ dnac_verify }}"
      dnac_port: "{{ dnac_port }}"
      dnac_version: "{{ dnac_version }}"
      dnac_debug: "{{ dnac_debug }}"
      validate_response_schema: false
  gather_facts: false
  tasks:
    # - name: Different body
    #   cisco.dnac.business_sda_hostonboarding_ssid_ippool:
    #     <<: *dnac_login
    #     state: present
    #     #siteNameHierarchy: "Ansible"
    #     siteNameHierarchy: "Global/United Kingdom/Barlborough"
    #     ssidNames:
    #       - "IOT"
    #       #- "SDA_Guest"
    #       #s- "SDA_Guest2"
    #     vlanName: "Ansible"
    #   register: result

    # - name: Show result
    #   ansible.builtin.debug:
    #     msg: "{{ result }}"

    ##https://github.com/cisco-en-programmability/dnacenter-ansible/issues/79
    ## Solved -> sdk
    # - name: Assign default authentication profile to fabric sites.
    #   cisco.dnac.sda_fabric_authentication_profile:
    #     dnac_host: "{{dnac_host}}"
    #     dnac_username: "{{dnac_username}}"
    #     dnac_password: "{{dnac_password}}"
    #     dnac_verify: "{{dnac_verify}}"
    #     dnac_port: "{{dnac_port}}"
    #     dnac_version: "{{dnac_version}}"
    #     dnac_debug: "{{dnac_debug}}"
    #     #validate_response_schema: false
    #     state: present
    #     payload:
    #     - siteNameHierarchy: "Global/Shanghai/SHA-17/SH_Floor_1"
    #       authenticateTemplateName: "No Authentication"

    ## https://github.com/cisco-en-programmability/dnacenter-ansible/issues/80
    ## Solved -> Ansible
    ## Cant delete
    # - name: Assign IP Pool to VN and fabric sites.
    #   cisco.dnac.sda_virtual_network_ip_pool:
    #     dnac_host: "{{dnac_host}}"
    #     dnac_username: "{{dnac_username}}"
    #     dnac_password: "{{dnac_password}}"
    #     dnac_verify: "{{dnac_verify}}"
    #     dnac_port: "{{dnac_port}}"
    #     dnac_version: "{{dnac_version}}"
    #     dnac_debug: "{{dnac_debug}}"
    #     state: absent
    #     virtualNetworkName: "OT"
    #     ipPoolName: "HQ_VN_OT"
    #     siteNameHierarchy: "Global/Shanghai/SHA-17/SH_Floor_1"
      
    ## https://github.com/cisco-en-programmability/dnacenter-ansible/issues/82
    ## Question
    # - name: Assign devices to site.
    #   cisco.dnac.site_assign_device:
    #     dnac_host: "{{dnac_host}}"
    #     dnac_username: "{{dnac_username}}"
    #     dnac_password: "{{dnac_password}}"
    #     dnac_verify: "{{dnac_verify}}"
    #     dnac_port: "{{dnac_port}}"
    #     dnac_version: "2.2.3.3"
    #     dnac_debug: "{{dnac_debug}}"
    #     siteId: "3e0db2cd-cf3a-4dbd-bfb9-739271ffc20b"
    #     device:
    #     - ip: "10.0.0.2"
    #   register: result

    - name: Create
      cisco.dnac.assign_device_to_site:
        dnac_host: "{{dnac_host}}"
        dnac_username: "{{dnac_username}}"
        dnac_password: "{{dnac_password}}"
        dnac_verify: "{{dnac_verify}}"
        dnac_port: "{{dnac_port}}"
        dnac_version: "{{dnac_version}}"
        dnac_debug: "{{dnac_debug}}"
        siteId: "3e0db2cd-cf3a-4dbd-bfb9-739271ffc20b"
        device:
        - ip: "10.0.0.2"
      register: result
    - name: Show result
      ansible.builtin.debug:
        msg: "{{ result }}"